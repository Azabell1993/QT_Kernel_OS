\doxysection{kernel\+\_\+chat.\+c}
\hypertarget{kernel__chat_8c_source}{}\label{kernel__chat_8c_source}\index{C\_lib/src/kernel\_chat.c@{C\_lib/src/kernel\_chat.c}}
\mbox{\hyperlink{kernel__chat_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <string.h>}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <unistd.h>}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <sys/socket.h>}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <arpa/inet.h>}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <stdarg.h>}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00008}00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{kernel__smartptr_8h}{kernel\_smartptr.h}}"{}}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00009}00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{kernel__uniqueptr_8h}{kernel\_uniqueptr.h}}"{}}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <fcntl.h>}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00011}00011\ \textcolor{preprocessor}{\#include\ <pthread.h>}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00013}\mbox{\hyperlink{kernel__chat_8c_ae9a2dfaddc7885a43c4dfdd24c8a8c55}{00013}}\ \textcolor{preprocessor}{\#define\ DEFAULT\_TCP\_PORT\ 5100}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00014}\mbox{\hyperlink{kernel__chat_8c_a0a8f91f93d75a07f0ae45077db45b3eb}{00014}}\ \textcolor{preprocessor}{\#define\ MAX\_CLIENTS\ 10}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00015}\mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{00015}}\ \textcolor{preprocessor}{\#define\ BUFFER\_SIZE\ 1024}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00023}00023\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_ad3e4a12f1a026b2af908e5c63a14049e}{auto\_daemon\_mode}}();}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00024}00024\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a0191d71ac8fe75567fce427199c9f479}{manual\_server\_mode}}();}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00025}00025\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00038}00038\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_af0f746b4f3a8976eebdf2fe3f62fd278}{list\_users}}();}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00045}00045\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a59b050a6b045ada0e3c0e5def2d3e262}{kill\_user}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *username);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00052}00052\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a976aab55fed55d6ad22ce34e80da7247}{kill\_room}}(\textcolor{keywordtype}{int}\ room\_id);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00059}00059\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00060}00060\ \ \ \ \ \textcolor{keywordtype}{int}\ client\_fd;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00061}00061\ \ \ \ \ \textcolor{keywordtype}{int}\ client\_id;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00062}00062\ \ \ \ \ \textcolor{keywordtype}{int}\ room\_id;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00063}00063\ \ \ \ \ \textcolor{keywordtype}{char}\ username[\mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}}];\ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00064}00064\ \ \ \ \ pthread\_mutex\_t\ *client\_mutex;\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00065}00065\ \}\ \mbox{\hyperlink{struct_client_info}{ClientInfo}};}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00066}00066\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00072}\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{00072}}\ \mbox{\hyperlink{struct_smart_ptr}{SmartPtr}}\ \mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[\mbox{\hyperlink{kernel__chat_8c_a0a8f91f93d75a07f0ae45077db45b3eb}{MAX\_CLIENTS}}];}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00073}00073\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00079}00079\ \mbox{\hyperlink{struct_unique_ptr}{UniquePtr}}\ \mbox{\hyperlink{kernel__chat_8c_ac61360dbe29daa4ef0965e19f858bbd6}{create\_unique\_ptr}}(\textcolor{keywordtype}{size\_t}\ size,\ \textcolor{keywordtype}{void}\ (*deleter)(\textcolor{keywordtype}{void}*));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00088}00088\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{kernel__chat_8c_a952e4e16f921c382b6d7b46e359ba97c}{create\_network\_tcp\_process}}(\textcolor{keywordtype}{int}\ num\_tcp\_proc,\ ...);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00089}00089\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00097}00097\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a3fbae3093079ea93ff5b70ebdc3782e5}{broadcast\_message}}(\textcolor{keywordtype}{int}\ sender\_fd,\ \textcolor{keywordtype}{char}\ *message,\ \textcolor{keywordtype}{int}\ room\_id);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00098}00098\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00104}00104\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a6bf4383ffd827293c7ade8c0fc4a6dea}{log\_chat\_message}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *message);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00112}00112\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{kernel__chat_8c_ae1b5f4bb3407d493369655b3cbadca20}{client\_handler}}(\textcolor{keywordtype}{void}\ *arg);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00120}00120\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_ab90d6b7a32a39643e497dd5e4195b104}{release\_client}}(\textcolor{keywordtype}{int}\ sock);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00121}00121\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00129}00129\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{kernel__chat_8c_a1c6b0123694e94c369c94ec8c0eb0096}{server\_input\_handler}}(\textcolor{keywordtype}{void}\ *arg);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00130}00130\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00137}00137\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a16ff14c99c5891fbfdb0084f5ccfd2d1}{send\_server\_message}}(\textcolor{keywordtype}{char}\ *message);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00138}00138\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00145}00145\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a59b050a6b045ada0e3c0e5def2d3e262}{kill\_user}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *username);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00146}00146\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00152}\mbox{\hyperlink{kernel__chat_8c_af0f746b4f3a8976eebdf2fe3f62fd278}{00152}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_af0f746b4f3a8976eebdf2fe3f62fd278}{list\_users}}()\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00153}00153\ \ \ \ \ printf(\textcolor{stringliteral}{"{}현재\ 접속\ 중인\ 유저\ 목록:\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00154}00154\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{kernel__chat_8c_a0a8f91f93d75a07f0ae45077db45b3eb}{MAX\_CLIENTS}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00155}00155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00156}00156\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *client\_info\ =\ (\mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *)\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00157}00157\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}User:\ \%s,\ Room:\ \%d\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a98894b89e8b36299fcdfd38caca7bf1a}{username}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a01133148ac3e031d6ea74403f7f54fb2}{room\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00158}00158\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00159}00159\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00160}00160\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00161}00161\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ room\_id\ =\ 1;\ room\_id\ <=\ 5;\ room\_id++)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00162}00162\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ user\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00163}00163\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{kernel__chat_8c_a0a8f91f93d75a07f0ae45077db45b3eb}{MAX\_CLIENTS}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *client\_info\ =\ (\mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *)\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00166}00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (client\_info-\/>\mbox{\hyperlink{struct_client_info_a01133148ac3e031d6ea74403f7f54fb2}{room\_id}}\ ==\ room\_id)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00167}00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ user\_count++;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00168}00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00169}00169\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00170}00170\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00171}00171\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Room\ \%d:\ \%d명\(\backslash\)n"{}},\ room\_id,\ user\_count);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00172}00172\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00173}00173\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00174}00174\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00180}\mbox{\hyperlink{kernel__chat_8c_a976aab55fed55d6ad22ce34e80da7247}{00180}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a976aab55fed55d6ad22ce34e80da7247}{kill\_room}}(\textcolor{keywordtype}{int}\ room\_id)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00181}00181\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{kernel__chat_8c_a0a8f91f93d75a07f0ae45077db45b3eb}{MAX\_CLIENTS}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00182}00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00183}00183\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *client\_info\ =\ (\mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *)\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00184}00184\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (client\_info-\/>\mbox{\hyperlink{struct_client_info_a01133148ac3e031d6ea74403f7f54fb2}{room\_id}}\ ==\ room\_id)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ send(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}},\ \textcolor{stringliteral}{"{}The\ room\ has\ been\ closed.\ You\ have\ been\ kicked\ out.\(\backslash\)n"{}},\ strlen(\textcolor{stringliteral}{"{}The\ room\ has\ been\ closed.\ You\ have\ been\ kicked\ out.\(\backslash\)n"{}}),\ 0);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00186}00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_ab90d6b7a32a39643e497dd5e4195b104}{release\_client}}(i);\ \ \textcolor{comment}{//\ Properly\ release\ client}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00188}00188\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00189}00189\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00190}00190\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Room\ \%d\ has\ been\ closed,\ and\ all\ users\ have\ been\ kicked.\(\backslash\)n"{}},\ room\_id);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00191}00191\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00199}00199\ \mbox{\hyperlink{struct_smart_ptr}{SmartPtr}}\ \mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[\mbox{\hyperlink{kernel__chat_8c_a0a8f91f93d75a07f0ae45077db45b3eb}{MAX\_CLIENTS}}];}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00200}00200\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00206}\mbox{\hyperlink{kernel__chat_8c_ad3e4fa8e66d5e926a5b122bc5afd4e45}{00206}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_ad3e4fa8e66d5e926a5b122bc5afd4e45}{add\_new\_client}}(\textcolor{keywordtype}{int}\ sock,\ \textcolor{keywordtype}{int}\ client\_id,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *username)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00207}00207\ \ \ \ \ \mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *client\_info\ =\ (\mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *)malloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_client_info}{ClientInfo}}));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00208}00208\ \ \ \ \ client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}}\ =\ sock;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00209}00209\ \ \ \ \ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}}\ =\ client\_id;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00210}00210\ \ \ \ \ strcpy(client\_info-\/>\mbox{\hyperlink{struct_client_info_a98894b89e8b36299fcdfd38caca7bf1a}{username}},\ username);\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00211}00211\ \ \ \ \ pthread\_mutex\_t\ *client\_mutex\ =\ (pthread\_mutex\_t\ *)malloc(\textcolor{keyword}{sizeof}(pthread\_mutex\_t));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00212}00212\ \ \ \ \ pthread\_mutex\_init(client\_mutex,\ NULL);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00213}00213\ \ \ \ \ client\_info-\/>\mbox{\hyperlink{struct_client_info_ae79b0929eec0a9a16c99e7e72da7d148}{client\_mutex}}\ =\ client\_mutex;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00214}00214\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00215}00215\ \ \ \ \ \textcolor{comment}{//\ client\_infos[sock]\ =\ create\_smart\_ptr(client\_info,\ free);}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00216}00216\ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[sock]\ =\ \mbox{\hyperlink{kernel__smartptr_8h_ae99435bb4eb679a3bb14ec5cd4b66ffc}{create\_smart\_ptr}}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_client_info}{ClientInfo}}),\ client\_info,\ free);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00217}00217\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00218}00218\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00224}\mbox{\hyperlink{kernel__chat_8c_ab90d6b7a32a39643e497dd5e4195b104}{00224}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_ab90d6b7a32a39643e497dd5e4195b104}{release\_client}}(\textcolor{keywordtype}{int}\ sock)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00225}00225\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[sock].ptr\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00226}00226\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *client\_info\ =\ (\mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *)\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[sock].ptr;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00227}00227\ \ \ \ \ \ \ \ \ close(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00228}00228\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kernel__uniqueptr_8h_a9f9f63294c5718add8a0f6dac5b5697d}{release\_shared\_ptr}}((\mbox{\hyperlink{struct_shared_ptr}{SharedPtr}}*)\&\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[sock]);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00229}00229\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}클라이언트\ \%d\ 연결\ 종료\ 및\ 메모리\ 해제\ 완료\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00230}00230\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00231}00231\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00232}00232\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00233}00233\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00239}\mbox{\hyperlink{kernel__chat_8c_a59b050a6b045ada0e3c0e5def2d3e262}{00239}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a59b050a6b045ada0e3c0e5def2d3e262}{kill\_user}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *username)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00240}00240\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{kernel__chat_8c_a0a8f91f93d75a07f0ae45077db45b3eb}{MAX\_CLIENTS}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00241}00241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00242}00242\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *client\_info\ =\ (\mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *)\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00243}00243\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strcmp(client\_info-\/>\mbox{\hyperlink{struct_client_info_a98894b89e8b36299fcdfd38caca7bf1a}{username}},\ username)\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00244}00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ send(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}},\ \textcolor{stringliteral}{"{}You\ have\ been\ kicked\ from\ the\ chat.\(\backslash\)n"{}},\ strlen(\textcolor{stringliteral}{"{}You\ have\ been\ kicked\ from\ the\ chat.\(\backslash\)n"{}}),\ 0);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00245}00245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_ab90d6b7a32a39643e497dd5e4195b104}{release\_client}}(i);\ \ \textcolor{comment}{//\ Properly\ release\ client}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00246}00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}User\ \%s\ has\ been\ kicked.\(\backslash\)n"{}},\ username);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00247}00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00248}00248\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00249}00249\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00250}00250\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00251}00251\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00252}00252\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00260}\mbox{\hyperlink{kernel__chat_8c_a3fbae3093079ea93ff5b70ebdc3782e5}{00260}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a3fbae3093079ea93ff5b70ebdc3782e5}{broadcast\_message}}(\textcolor{keywordtype}{int}\ sender\_fd,\ \textcolor{keywordtype}{char}\ *message,\ \textcolor{keywordtype}{int}\ room\_id)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00261}00261\ \ \ \ \ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{kernel__chat_8c_a3fbae3093079ea93ff5b70ebdc3782e5}{broadcast\_message}}[\mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}}\ +\ 50];}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00262}00262\ \ \ \ \ \mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *sender\_info\ =\ (\mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *)\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[sender\_fd].ptr;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00263}00263\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00264}00264\ \ \ \ \ snprintf(\mbox{\hyperlink{kernel__chat_8c_a3fbae3093079ea93ff5b70ebdc3782e5}{broadcast\_message}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{kernel__chat_8c_a3fbae3093079ea93ff5b70ebdc3782e5}{broadcast\_message}}),\ \textcolor{stringliteral}{"{}[\%s]:\ \%s"{}},\ sender\_info-\/>\mbox{\hyperlink{struct_client_info_a98894b89e8b36299fcdfd38caca7bf1a}{username}},\ message);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00265}00265\ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a6bf4383ffd827293c7ade8c0fc4a6dea}{log\_chat\_message}}(\mbox{\hyperlink{kernel__chat_8c_a3fbae3093079ea93ff5b70ebdc3782e5}{broadcast\_message}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00266}00266\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00267}00267\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{kernel__chat_8c_a0a8f91f93d75a07f0ae45077db45b3eb}{MAX\_CLIENTS}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00268}00268\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00269}00269\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *client\_info\ =\ (\mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *)\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00270}00270\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (client\_info-\/>\mbox{\hyperlink{struct_client_info_a01133148ac3e031d6ea74403f7f54fb2}{room\_id}}\ ==\ room\_id\ \&\&\ client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}}\ !=\ sender\_fd)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00271}00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ write(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}},\ \mbox{\hyperlink{kernel__chat_8c_a3fbae3093079ea93ff5b70ebdc3782e5}{broadcast\_message}},\ strlen(\mbox{\hyperlink{kernel__chat_8c_a3fbae3093079ea93ff5b70ebdc3782e5}{broadcast\_message}}));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00272}00272\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00273}00273\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00274}00274\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00275}00275\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00276}00276\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00277}00277\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00278}00278\ \textcolor{preprocessor}{\#include\ <time.h>}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00279}00279\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00280}\mbox{\hyperlink{kernel__chat_8c_a54baead9ac1aa7d2d2f886956ac57c1e}{00280}}\ pthread\_mutex\_t\ \mbox{\hyperlink{kernel__chat_8c_a54baead9ac1aa7d2d2f886956ac57c1e}{log\_mutex}}\ =\ PTHREAD\_MUTEX\_INITIALIZER;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00281}00281\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00287}\mbox{\hyperlink{kernel__chat_8c_a6bf4383ffd827293c7ade8c0fc4a6dea}{00287}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a6bf4383ffd827293c7ade8c0fc4a6dea}{log\_chat\_message}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *message)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00288}00288\ \ \ \ \ \textcolor{comment}{//\ 절대\ 경로로\ 로그\ 파일\ 지정}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00289}00289\ \ \ \ \ \textcolor{keywordtype}{char}\ log\_path[\mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}}];}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00290}00290\ \ \ \ \ time\_t\ now\ =\ time(NULL);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00291}00291\ \ \ \ \ \textcolor{keyword}{struct\ }tm\ *t\ =\ localtime(\&now);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00292}00292\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00293}00293\ \ \ \ \ \textcolor{comment}{//\ 현재\ 날짜를\ 기반으로\ 로그\ 파일명을\ 만듦}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00294}00294\ \ \ \ \ \textcolor{comment}{//\ 반드시\ touch\ 명령어로\ 해당\ 파일을\ 미리\ 생성해두어야\ 함}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00295}00295\ \ \ \ \ \textcolor{comment}{//\ 권한에\ 대해서도\ 고려해야\ 함}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00296}00296\ \ \ \ \ \textcolor{comment}{//\ sudo\ touch\ /var/log/chatlog\_20240915.log}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00297}00297\ \ \ \ \ \textcolor{comment}{//\ sudo\ chmod\ 777\ /var/log/chatlog\_20240915.log}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00298}00298\ \ \ \ \ strftime(log\_path,\ \textcolor{keyword}{sizeof}(log\_path),\ \textcolor{stringliteral}{"{}/var/log/chatlog\_\%Y\%m\%d.log"{}},\ t);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00299}00299\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00300}00300\ \ \ \ \ \textcolor{comment}{//\ 뮤텍스\ 잠금으로\ 동시\ 접근\ 제어}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00301}00301\ \ \ \ \ pthread\_mutex\_lock(\&\mbox{\hyperlink{kernel__chat_8c_a54baead9ac1aa7d2d2f886956ac57c1e}{log\_mutex}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00302}00302\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00303}00303\ \ \ \ \ FILE\ *log\_file\ =\ fopen(log\_path,\ \textcolor{stringliteral}{"{}a"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00304}00304\ \ \ \ \ \textcolor{keywordflow}{if}\ (log\_file\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00305}00305\ \ \ \ \ \ \ \ \ perror(\textcolor{stringliteral}{"{}로그\ 파일을\ 열\ 수\ 없습니다."{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00306}00306\ \ \ \ \ \ \ \ \ pthread\_mutex\_unlock(\&\mbox{\hyperlink{kernel__chat_8c_a54baead9ac1aa7d2d2f886956ac57c1e}{log\_mutex}});\ \ \textcolor{comment}{//\ 잠금\ 해제}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00307}00307\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00308}00308\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00309}00309\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00310}00310\ \ \ \ \ \textcolor{comment}{//\ 로그\ 파일에\ 메시지\ 기록}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00311}00311\ \ \ \ \ fprintf(log\_file,\ \textcolor{stringliteral}{"{}\%s\(\backslash\)n"{}},\ message);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00312}00312\ \ \ \ \ fclose(log\_file);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00313}00313\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00314}00314\ \ \ \ \ \textcolor{comment}{//\ 뮤텍스\ 잠금\ 해제}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00315}00315\ \ \ \ \ pthread\_mutex\_unlock(\&\mbox{\hyperlink{kernel__chat_8c_a54baead9ac1aa7d2d2f886956ac57c1e}{log\_mutex}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00316}00316\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00317}00317\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00323}\mbox{\hyperlink{kernel__chat_8c_ae1b5f4bb3407d493369655b3cbadca20}{00323}}\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{kernel__chat_8c_ae1b5f4bb3407d493369655b3cbadca20}{client\_handler}}(\textcolor{keywordtype}{void}\ *arg)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00324}00324\ \ \ \ \ \mbox{\hyperlink{struct_smart_ptr}{SmartPtr}}\ *sp\ =\ (\mbox{\hyperlink{struct_smart_ptr}{SmartPtr}}\ *)arg;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00325}00325\ \ \ \ \ \mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *client\_info\ =\ (\mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *)sp-\/>\mbox{\hyperlink{struct_smart_ptr_afa5aac6520f0d05d01d7ac99e5ec78e3}{ptr}};}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00326}00326\ \ \ \ \ \textcolor{keywordtype}{char}\ buffer[\mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}}];}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00327}00327\ \ \ \ \ \textcolor{keywordtype}{int}\ nbytes;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00328}00328\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00329}00329\ \ \ \ \ \textcolor{comment}{//\ 사용자명\ 수신}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00330}00330\ \ \ \ \ memset(buffer,\ 0,\ \textcolor{keyword}{sizeof}(buffer));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00331}00331\ \ \ \ \ nbytes\ =\ read(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}},\ buffer,\ \mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00332}00332\ \ \ \ \ \textcolor{keywordflow}{if}\ (nbytes\ <=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00333}00333\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}사용자명\ 수신\ 실패\ 또는\ 클라이언트\ 연결\ 종료\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00334}00334\ \ \ \ \ \ \ \ \ close(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00335}00335\ \ \ \ \ \ \ \ \ release(sp);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00336}00336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00337}00337\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00338}00338\ \ \ \ \ strncpy(client\_info-\/>\mbox{\hyperlink{struct_client_info_a98894b89e8b36299fcdfd38caca7bf1a}{username}},\ buffer,\ \mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00339}00339\ \ \ \ \ printf(\textcolor{stringliteral}{"{}사용자명:\ \%s\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a98894b89e8b36299fcdfd38caca7bf1a}{username}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00340}00340\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00341}00341\ \ \ \ \ \textcolor{comment}{//\ 채팅방\ 선택\ 수신}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00342}00342\ \ \ \ \ memset(buffer,\ 0,\ \textcolor{keyword}{sizeof}(buffer));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00343}00343\ \ \ \ \ nbytes\ =\ read(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}},\ buffer,\ \mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00344}00344\ \ \ \ \ \textcolor{keywordflow}{if}\ (nbytes\ <=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00345}00345\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}채팅방\ 수신\ 실패\ 또는\ 클라이언트\ 연결\ 종료\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00346}00346\ \ \ \ \ \ \ \ \ close(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00347}00347\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00348}00348\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 클라이언트\ 종료\ 시\ 뮤텍스\ 제거}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00349}00349\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}클라이언트\ \%d\ 연결\ 종료에\ 따른\ 뮤텍스\ 파괴"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00350}00350\ \ \ \ \ \ \ \ \ pthread\_mutex\_destroy(client\_info\ -\/>\ client\_mutex);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00351}00351\ \ \ \ \ \ \ \ \ free(client\_info\ -\/>\ client\_mutex);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00352}00352\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}뮤텍스\ 파괴\ 완료.\ 클라이언트\ 아이디\ :\ [\ \%d\ ]\ -\/>\ destroyed\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00353}00353\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00354}00354\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(client\_info-\/>\mbox{\hyperlink{struct_client_info_a01133148ac3e031d6ea74403f7f54fb2}{room\_id}}\ !=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00355}00355\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}클라이언트\ \%d가\ 채팅방\ \%d에서\ 퇴장했습니다.\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a01133148ac3e031d6ea74403f7f54fb2}{room\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00356}00356\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00357}00357\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}클라이언트\ \%d\ 연결\ 종료\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00358}00358\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00359}00359\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00360}00360\ \ \ \ \ \ \ \ \ release(sp);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00361}00361\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00362}00362\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00363}00363\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00364}00364\ \ \ \ \ client\_info-\/>\mbox{\hyperlink{struct_client_info_a01133148ac3e031d6ea74403f7f54fb2}{room\_id}}\ =\ atoi(buffer);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00365}00365\ \ \ \ \ printf(\textcolor{stringliteral}{"{}클라이언트\ \%d가\ 채팅방\ \%d에\ 입장했습니다.\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a01133148ac3e031d6ea74403f7f54fb2}{room\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00366}00366\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00367}00367\ \ \ \ \ \textcolor{comment}{//\ 메시지\ 처리}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00368}00368\ \ \ \ \ \textcolor{keywordflow}{while}\ ((nbytes\ =\ read(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}},\ buffer,\ \mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}}))\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00369}00369\ \ \ \ \ \ \ \ \ buffer[nbytes]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00370}00370\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}클라이언트\ \%d\ (\%s)\ 메시지:\ \%s\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a98894b89e8b36299fcdfd38caca7bf1a}{username}},\ buffer);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00371}00371\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a3fbae3093079ea93ff5b70ebdc3782e5}{broadcast\_message}}(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}},\ buffer,\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a01133148ac3e031d6ea74403f7f54fb2}{room\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00372}00372\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00373}00373\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00374}00374\ \ \ \ \ printf(\textcolor{stringliteral}{"{}클라이언트\ \%d\ 연결\ 종료\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00375}00375\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00376}00376\ \ \ \ \ \textcolor{comment}{//\ 뮤텍스\ 파괴\ 및\ 참조\ 감소\ 확인}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00377}00377\ \ \ \ \ printf(\textcolor{stringliteral}{"{}클라이언트\ \%d\ 연결\ 종료.\ 뮤텍스\ 파괴\ 중...\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00378}00378\ \ \ \ \ pthread\_mutex\_destroy(client\_info\ -\/>\ client\_mutex);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00379}00379\ \ \ \ \ free(client\_info\ -\/>\ client\_mutex);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00380}00380\ \ \ \ \ printf(\textcolor{stringliteral}{"{}뮤텍스\ 파괴\ 완료.\ 클라이언트\ 아이디\ :\ [\ \%d\ ]\ -\/>\ destroyed\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00381}00381\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00382}00382\ \ \ \ \ close(client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00383}00383\ \ \ \ \ release(sp);\ \ \textcolor{comment}{//\ 스마트\ 포인터\ 해제}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00384}00384\ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00385}00385\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00392}\mbox{\hyperlink{kernel__chat_8c_a952e4e16f921c382b6d7b46e359ba97c}{00392}}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{kernel__chat_8c_a952e4e16f921c382b6d7b46e359ba97c}{create\_network\_tcp\_process}}(\textcolor{keywordtype}{int}\ num\_tcp\_proc,\ ...)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00393}00393\ \ \ \ \ va\_list\ args;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00394}00394\ \ \ \ \ va\_start(args,\ num\_tcp\_proc);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00395}00395\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00396}00396\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_tcp\_proc;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00397}00397\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ ssock,\ client\_count\ =\ 1;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00398}00398\ \ \ \ \ \ \ \ \ socklen\_t\ clen;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00399}00399\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }sockaddr\_in\ servaddr,\ cliaddr;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00400}00400\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ char\ buffer[BUFFER\_SIZE];}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00401}00401\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ const\ char\ *ip\_address\ =\ va\_arg(args,\ const\ char*);}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00402}00402\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ client\_ip[INET\_ADDRSTRLEN];}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00403}00403\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00404}00404\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ port\ =\ va\_arg(args,\ \textcolor{keywordtype}{int});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00405}00405\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00406}00406\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((ssock\ =\ socket(AF\_INET,\ SOCK\_STREAM,\ 0))\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00407}00407\ \ \ \ \ \ \ \ \ \ \ \ \ perror(\textcolor{stringliteral}{"{}socket()"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00408}00408\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00409}00409\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00410}00410\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00411}00411\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ enable\ =\ 1;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00412}00412\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (setsockopt(ssock,\ SOL\_SOCKET,\ SO\_REUSEADDR,\ \&enable,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}))\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00413}00413\ \ \ \ \ \ \ \ \ \ \ \ \ perror(\textcolor{stringliteral}{"{}setsockopt(SO\_REUSEADDR)\ failed"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00415}00415\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00416}00416\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00417}00417\ \ \ \ \ \ \ \ \ memset(\&servaddr,\ 0,\ \textcolor{keyword}{sizeof}(servaddr));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00418}00418\ \ \ \ \ \ \ \ \ servaddr.sin\_family\ =\ AF\_INET;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00419}00419\ \ \ \ \ \ \ \ \ servaddr.sin\_addr.s\_addr\ =\ htons(INADDR\_ANY);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00420}00420\ \ \ \ \ \ \ \ \ servaddr.sin\_port\ =\ htons(port);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00421}00421\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00422}00422\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bind(ssock,\ (\textcolor{keyword}{struct}\ sockaddr\ *)\&servaddr,\ \textcolor{keyword}{sizeof}(servaddr))\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00423}00423\ \ \ \ \ \ \ \ \ \ \ \ \ perror(\textcolor{stringliteral}{"{}bind()"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00424}00424\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00425}00425\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00426}00426\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00427}00427\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (listen(ssock,\ 8)\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00428}00428\ \ \ \ \ \ \ \ \ \ \ \ \ perror(\textcolor{stringliteral}{"{}listen()"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00429}00429\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00430}00430\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00431}00431\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}서버가\ 포트\ \%d에서\ 듣고\ 있습니다.\(\backslash\)n"{}},\ port);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00432}00432\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00433}00433\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00434}00434\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}서버가\ 클라이언트의\ 연결을\ 기다립니다...\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00435}00435\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00436}00436\ \ \ \ \ \ \ \ \ pthread\_t\ tid;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00437}00437\ \ \ \ \ \ \ \ \ pthread\_create(\&tid,\ NULL,\ \mbox{\hyperlink{kernel__chat_8c_a1c6b0123694e94c369c94ec8c0eb0096}{server\_input\_handler}},\ NULL);\ \textcolor{comment}{//\ 서버\ 입력\ 처리\ 스레드\ 생성}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00438}00438\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00439}00439\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (1)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00440}00440\ \ \ \ \ \ \ \ \ \ \ \ \ clen\ =\ \textcolor{keyword}{sizeof}(cliaddr);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00441}00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ csock\ =\ accept(ssock,\ (\textcolor{keyword}{struct}\ sockaddr\ *)\&cliaddr,\ \&clen);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00442}00442\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (csock\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00443}00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ inet\_ntop(AF\_INET,\ \&cliaddr.sin\_addr,\ client\_ip,\ INET\_ADDRSTRLEN);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00444}00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}[\ 클라이언트\ \%d가\ 연결되었습니다.\ IP:\ \%s\ ]\(\backslash\)n"{}},\ client\_count,\ client\_ip);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00445}00445\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00446}00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pthread\_mutex\_t\ *client\_mutex\ =\ (pthread\_mutex\_t\ *)malloc(\textcolor{keyword}{sizeof}(pthread\_mutex\_t));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00447}00447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pthread\_mutex\_init(client\_mutex,\ NULL);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00448}00448\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00449}00449\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *client\_info\ =\ (\mbox{\hyperlink{struct_client_info}{ClientInfo}}\ *)malloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_client_info}{ClientInfo}}));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00450}00450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ client\_info-\/>\mbox{\hyperlink{struct_client_info_afcdb55ea154b8f5f383c90281918f751}{client\_fd}}\ =\ csock;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00451}00451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}}\ =\ client\_count++;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00452}00452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ client\_info-\/>\mbox{\hyperlink{struct_client_info_ae79b0929eec0a9a16c99e7e72da7d148}{client\_mutex}}\ =\ client\_mutex;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00453}00453\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00454}00454\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 클라이언트\ 정보를\ 스마트\ 포인터로\ 관리}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00455}00455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ client\_infos[csock]\ =\ create\_smart\_ptr(client\_info,\ free);}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00456}00456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[csock]\ =\ \mbox{\hyperlink{kernel__smartptr_8h_ae99435bb4eb679a3bb14ec5cd4b66ffc}{create\_smart\_ptr}}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_client_info}{ClientInfo}}),\ client\_info,\ free);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00457}00457\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00458}00458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 클라이언트\ 스레드\ 생성}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00459}00459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pthread\_create(\&tid,\ NULL,\ \mbox{\hyperlink{kernel__chat_8c_ae1b5f4bb3407d493369655b3cbadca20}{client\_handler}},\ (\textcolor{keywordtype}{void}\ *)\&\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[csock]);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00460}00460\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00461}00461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}mutex\ \%d\ called\(\backslash\)n"{}},\ client\_info-\/>\mbox{\hyperlink{struct_client_info_a3375189b046a181d4875ac1fdea96fea}{client\_id}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00462}00462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00463}00463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 추가:\ 클라이언트\ 종료\ 시\ 뮤텍스\ 제거}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00464}00464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pthread\_detach(tid);\ \ \textcolor{comment}{//\ 스레드\ 분리}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00465}00465\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00466}00466\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00467}00467\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00468}00468\ \ \ \ \ \ \ \ \ close(ssock);\ \ \textcolor{comment}{//\ 소켓\ 닫기}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00469}00469\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00470}00470\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00471}00471\ \ \ \ \ va\_end(args);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00472}00472\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00473}00473\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00474}00474\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00482}\mbox{\hyperlink{kernel__chat_8c_a1c6b0123694e94c369c94ec8c0eb0096}{00482}}\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{kernel__chat_8c_a1c6b0123694e94c369c94ec8c0eb0096}{server\_input\_handler}}(\textcolor{keywordtype}{void}\ *arg)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00483}00483\ \ \ \ \ (void)arg;\ \ \textcolor{comment}{//\ 미사용\ 인자\ 처리}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00484}00484\ \ \ \ \ \textcolor{keywordtype}{char}\ buffer[\mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}}];}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00485}00485\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00486}00486\ \ \ \ \ \textcolor{keywordflow}{while}\ (1)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00487}00487\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 표준\ 입력으로부터\ 메시지\ 입력받기}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00488}00488\ \ \ \ \ \ \ \ \ fgets(buffer,\ \mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}},\ stdin);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00489}00489\ \ \ \ \ \ \ \ \ buffer[strcspn(buffer,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}})]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};\ \ \textcolor{comment}{//\ 개행\ 문자\ 제거}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00490}00490\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00491}00491\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 종료\ 명령어\ 처리}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00492}00492\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strcmp(buffer,\ \textcolor{stringliteral}{"{}exit"{}})\ ==\ 0\ ||\ strcmp(buffer,\ \textcolor{stringliteral}{"{}..."{}})\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00493}00493\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}채팅을\ 종료합니다.\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00494}00494\ \ \ \ \ \ \ \ \ \ \ \ \ exit(0);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00495}00495\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00496}00496\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00497}00497\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ list\ 명령어\ 처리}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00498}00498\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strcmp(buffer,\ \textcolor{stringliteral}{"{}list"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00499}00499\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_af0f746b4f3a8976eebdf2fe3f62fd278}{list\_users}}();}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00500}00500\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00501}00501\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00502}00502\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ kill\ 명령어\ 처리}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00503}00503\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strncmp(buffer,\ \textcolor{stringliteral}{"{}kill\ "{}},\ 5)\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00504}00504\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *username\ =\ buffer\ +\ 5;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00505}00505\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a59b050a6b045ada0e3c0e5def2d3e262}{kill\_user}}(username);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00506}00506\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00507}00507\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00508}00508\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ kill\ room\ 명령어\ 처리}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00509}00509\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strncmp(buffer,\ \textcolor{stringliteral}{"{}kill\ room\ "{}},\ 10)\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00510}00510\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ room\_id\ =\ atoi(buffer\ +\ 10);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00511}00511\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a976aab55fed55d6ad22ce34e80da7247}{kill\_room}}(room\_id);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00512}00512\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00513}00513\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00514}00514\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ grep\ -\/r\ 명령어\ 처리}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00515}00515\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strncmp(buffer,\ \textcolor{stringliteral}{"{}grep\ -\/r"{}},\ 7)\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00516}00516\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ command[\mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}}\ +\ 100];}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00517}00517\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ log\_filename[50];}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00518}00518\ \ \ \ \ \ \ \ \ \ \ \ \ time\_t\ now\ =\ time(NULL);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00519}00519\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }tm\ *t\ =\ localtime(\&now);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00520}00520\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00521}00521\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 로그\ 파일명에\ 날짜\ 붙이기}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00522}00522\ \ \ \ \ \ \ \ \ \ \ \ \ strftime(log\_filename,\ \textcolor{keyword}{sizeof}(log\_filename),\ \textcolor{stringliteral}{"{}/var/log/chatlog\_\%Y\%m\%d.log"{}},\ t);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00523}00523\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00524}00524\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ grep\ 명령어에\ 로그\ 파일\ 경로\ 포함}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00525}00525\ \ \ \ \ \ \ \ \ \ \ \ \ snprintf(command,\ \textcolor{keyword}{sizeof}(command),\ \textcolor{stringliteral}{"{}\%s\ \%s"{}},\ buffer,\ log\_filename);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00526}00526\ \ \ \ \ \ \ \ \ \ \ \ \ system(command);\ \ \textcolor{comment}{//\ 로그\ 파일에서\ grep\ 명령\ 실행}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00527}00527\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00528}00528\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00529}00529\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strlen(buffer)\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00530}00530\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a16ff14c99c5891fbfdb0084f5ccfd2d1}{send\_server\_message}}(buffer);\ \ \textcolor{comment}{//\ 서버\ 메시지\ 전송}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00531}00531\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00532}00532\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00533}00533\ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00534}00534\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00541}\mbox{\hyperlink{kernel__chat_8c_a16ff14c99c5891fbfdb0084f5ccfd2d1}{00541}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a16ff14c99c5891fbfdb0084f5ccfd2d1}{send\_server\_message}}(\textcolor{keywordtype}{char}\ *message)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00542}00542\ \ \ \ \ \textcolor{keywordtype}{char}\ server\_message[\mbox{\hyperlink{kernel__chat_8c_a6b20d41d6252e9871430c242cb1a56e7}{BUFFER\_SIZE}}\ +\ 50];}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00543}00543\ \ \ \ \ snprintf(server\_message,\ \textcolor{keyword}{sizeof}(server\_message),\ \textcolor{stringliteral}{"{}[서버]:\ \%s"{}},\ message);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00544}00544\ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a6bf4383ffd827293c7ade8c0fc4a6dea}{log\_chat\_message}}(server\_message);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00545}00545\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00546}00546\ \ \ \ \ \textcolor{comment}{//\ 채팅방에\ 있는\ 클라이언트들에게\ 메시지\ 전송}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00547}00547\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{kernel__chat_8c_a0a8f91f93d75a07f0ae45077db45b3eb}{MAX\_CLIENTS}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00548}00548\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{kernel__chat_8c_a7e063a6df6c28be68f168943245e0fb2}{client\_infos}}[i].ptr\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00549}00549\ \ \ \ \ \ \ \ \ \ \ \ \ write(i,\ server\_message,\ strlen(server\_message));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00550}00550\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00551}00551\ \ \ \ \ \}\ \ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00552}00552\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00553}00553\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00559}\mbox{\hyperlink{kernel__chat_8c_a869452f0c0952acd39230fcf0ef89c1e}{00559}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a869452f0c0952acd39230fcf0ef89c1e}{daemonize}}()\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00560}00560\ \ \ \ \ pid\_t\ pid,\ sid;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00561}00561\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00562}00562\ \ \ \ \ pid\ =\ fork();}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00563}00563\ \ \ \ \ \textcolor{keywordflow}{if}\ (pid\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00564}00564\ \ \ \ \ \ \ \ \ exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00565}00565\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00566}00566\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00567}00567\ \ \ \ \ \textcolor{keywordflow}{if}\ (pid\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00568}00568\ \ \ \ \ \ \ \ \ exit(EXIT\_SUCCESS);\ \ \textcolor{comment}{//\ 부모\ 프로세스\ 종료}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00569}00569\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00570}00570\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00571}00571\ \ \ \ \ \textcolor{comment}{//\ umask(0);}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00572}00572\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00573}00573\ \ \ \ \ \textcolor{comment}{//\ 로그\ 파일을\ 엽니다.\ 기존\ 코드에서\ 파일을\ 올바르게\ 여는지\ 확인하세요.}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00574}00574\ \ \ \ \ \textcolor{keywordtype}{int}\ fd\ =\ open(\textcolor{stringliteral}{"{}/home/pi/Desktop/veda/workspace/save/chat\_server.log"{}},\ O\_RDWR\ |\ O\_CREAT\ |\ O\_APPEND,\ 0600);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00575}00575\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fd\ ==\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00576}00576\ \ \ \ \ \ \ \ \ perror(\textcolor{stringliteral}{"{}open\ log"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00577}00577\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}로그\ 파일\ 열기\ 실패\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00578}00578\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}server.c\ 내의\ daemonize()함수에서\ 로그\ 파일을\ 열지\ 못했습니다.\ 새로\ 시작하는\ 장소이니\ 올바른\ 경로를\ 지정하세요.\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00579}00579\ \ \ \ \ \ \ \ \ exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00580}00580\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00581}00581\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}로그\ 파일\ 열기\ 성공\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00582}00582\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}올바른\ 경로로\ 지정이\ 되었고,\ 시작이\ 되었습니다.\ 이\ 작동은\ client에서\ 한번\ Exit를\ 하면\ server도\ 종료가\ 되므로,\ 반드시\ daemon\_start.sh를\ 사용하여\ 실행을\ 하세요.\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00583}00583\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00584}00584\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00585}00585\ \ \ \ \ \textcolor{comment}{//\ 로그\ 파일로\ stdout과\ stderr\ 리다이렉션}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00586}00586\ \ \ \ \ dup2(fd,\ STDOUT\_FILENO);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00587}00587\ \ \ \ \ dup2(fd,\ STDERR\_FILENO);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00588}00588\ \ \ \ \ close(fd);\ \ \textcolor{comment}{//\ 파일\ 디스크립터\ 닫기}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00589}00589\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00590}00590\ \ \ \ \ \textcolor{comment}{//\ 세션\ ID\ 설정}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00591}00591\ \ \ \ \ sid\ =\ setsid();}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00592}00592\ \ \ \ \ \textcolor{keywordflow}{if}\ (sid\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00593}00593\ \ \ \ \ \ \ \ \ exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00594}00594\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00595}00595\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00596}00596\ \ \ \ \ \textcolor{keywordflow}{if}\ ((chdir(\textcolor{stringliteral}{"{}/"{}}))\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00597}00597\ \ \ \ \ \ \ \ \ exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00598}00598\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00599}00599\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00600}00600\ \ \ \ \ \textcolor{comment}{//\ stdin,\ stdout,\ stderr\ 닫기}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00601}00601\ \ \ \ \ close(STDIN\_FILENO);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00602}00602\ \ \ \ \ close(STDOUT\_FILENO);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00603}00603\ \ \ \ \ close(STDERR\_FILENO);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00604}00604\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00605}00605\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00606}\mbox{\hyperlink{kernel__chat_8c_aadb38dd0c541b901618e30c674e723ae}{00606}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_aadb38dd0c541b901618e30c674e723ae}{logo}}()\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00607}00607\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[0;34m\ ▌\ \(\backslash\)033[0;33m▐·▄▄▄\ .·▄▄▄▄\ \ \ ▄▄▄·\ \ \ \ \ \ ▄▄▄·\ \ ▄▄·\ \ ▄▄▄·\ ·▄▄▄▄\ \ ▄▄▄\ .•\ \(\backslash\)033[0;34m▌\ \(\backslash\)033[0;37m▄\ ·.\ \ ▄·\ ▄▌\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00608}00608\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[0;34m▪█·█▌▀▄.▀·██▪\ ██\ ▐█\ ▀█\ \ \ \ \ ▐█\ ▀█\ ▐█\ ▌▪▐█\ ▀█\ ██▪\ ██\ ▀▄.▀··\(\backslash\)033[0;37m██\ ▐███▪▐█▪██▌\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00609}00609\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[0;34m▐█▐█•▐▀▀▪▄▐█·\ ▐█▌▄█▀▀█\ \ \ \ \ ▄█▀▀█\ ██\ ▄▄▄█▀▀█\ ▐█·\ ▐█▌▐▀▀▪▄▐█\ \(\backslash\)033[0;37m▌▐▌▐█·▐█▌▐█▪\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00610}00610\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[0;34m\ ███\ ▐█▄▄▌██.\ ██\ ▐█\ ▪▐▌\ \ \ \ ▐█\ ▪▐▌▐███▌▐█\ ▪▐▌██.\ ██\ ▐█▄▄▌\(\backslash\)033[0;37m██\ ██▌▐█▌\ ▐█▀·.\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00611}00611\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[0;34m.\ \(\backslash\)033[0;33m▀\ \ \ ▀▀▀\ ▀▀▀▀▀•\ \ ▀\ \ ▀\ \ \ \ \ \ ▀\ \ ▀\ ·▀▀▀\ \ ▀\ \ ▀\ ▀▀▀▀▀•\ \ \(\backslash\)033[0;37m▀▀▀\ ▀▀\ \ █▪▀▀▀\ \ ▀\ •\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00612}00612\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00613}00613\ \ \ \ \ \textcolor{comment}{//\ 색상\ 리셋}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00614}00614\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00615}00615\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00616}00616\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00622}\mbox{\hyperlink{kernel__chat_8c_ad3e4a12f1a026b2af908e5c63a14049e}{00622}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_ad3e4a12f1a026b2af908e5c63a14049e}{auto\_daemon\_mode}}()\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00623}00623\ \ \ \ \ printf(\textcolor{stringliteral}{"{}자동으로\ 데몬화하여\ 서버를\ 시작합니다.\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00624}00624\ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a869452f0c0952acd39230fcf0ef89c1e}{daemonize}}();\ \ \textcolor{comment}{//\ 데몬화\ 함수\ 호출}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00625}00625\ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a952e4e16f921c382b6d7b46e359ba97c}{create\_network\_tcp\_process}}(1,\ \textcolor{stringliteral}{"{}127.0.0.1"{}},\ \mbox{\hyperlink{kernel__chat_8c_ae9a2dfaddc7885a43c4dfdd24c8a8c55}{DEFAULT\_TCP\_PORT}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00626}00626\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00627}00627\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00633}\mbox{\hyperlink{kernel__chat_8c_a0191d71ac8fe75567fce427199c9f479}{00633}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_a0191d71ac8fe75567fce427199c9f479}{manual\_server\_mode}}()\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00634}00634\ \ \ \ \ \textcolor{keywordtype}{char}\ yn\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00635}00635\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)nPress\ Enter\ to\ continue..."{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00636}00636\ \ \ \ \ \textcolor{keywordflow}{while}\ (getchar()\ !=\ \textcolor{charliteral}{'\(\backslash\)n'});\ \ \textcolor{comment}{//\ Enter\ 키가\ 눌릴\ 때까지\ 대기}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00637}00637\ \ \ \ \ printf(\textcolor{stringliteral}{"{}이\ 프로그램을\ 자동으로\ 데몬\ 화\ 하시겠습니까?\ (y/n):\ "{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00638}00638\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00639}00639\ \ \ \ \ \textcolor{keywordflow}{while}\ (1)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00640}00640\ \ \ \ \ \ \ \ \ yn\ =\ getchar();\ \ \textcolor{comment}{//\ 한\ 문자를\ 입력받음}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00641}00641\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (yn\ ==\ \textcolor{charliteral}{'y'}\ ||\ yn\ ==\ \textcolor{charliteral}{'n'})\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00642}00642\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \ \textcolor{comment}{//\ y\ 또는\ n을\ 입력받으면\ 루프\ 종료}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00643}00643\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00644}00644\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}잘못된\ 입력입니다.\ (y/n):\ "{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00645}00645\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (getchar()\ !=\ \textcolor{charliteral}{'\(\backslash\)n'});\ \ \textcolor{comment}{//\ 버퍼를\ 비워서\ 남은\ 입력을\ 처리}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00646}00646\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00647}00647\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00648}00648\ \ \ \ \ \textcolor{keywordflow}{if}\ (yn\ ==\ \textcolor{charliteral}{'y'})\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00649}00649\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a869452f0c0952acd39230fcf0ef89c1e}{daemonize}}();\ \ \textcolor{comment}{//\ 데몬화\ 함수\ 호출}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00650}00650\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00651}00651\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}데몬화를\ 하지\ 않습니다.\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00652}00652\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00653}00653\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00654}00654\ \ \ \ \ \mbox{\hyperlink{kernel__chat_8c_a952e4e16f921c382b6d7b46e359ba97c}{create\_network\_tcp\_process}}(1,\ \textcolor{stringliteral}{"{}127.0.0.1"{}},\ \mbox{\hyperlink{kernel__chat_8c_ae9a2dfaddc7885a43c4dfdd24c8a8c55}{DEFAULT\_TCP\_PORT}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00655}00655\ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00656}00656\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00657}00657\ \textcolor{comment}{//\ /**}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00658}00658\ \textcolor{comment}{//\ \ *\ @brief\ main\ 함수}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00659}00659\ \textcolor{comment}{//\ \ *\ @param\ void}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00660}00660\ \textcolor{comment}{//\ \ *\ @return\ int}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00661}00661\ \textcolor{comment}{//\ \ */}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00662}00662\ \textcolor{comment}{//\ int\ main()}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00663}00663\ \textcolor{comment}{//\ \{}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00664}00664\ \textcolor{comment}{//\ \ \ \ \ char\ yn\ =\ '\(\backslash\)0';\ //\ 문자를\ 저장할\ 변수}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00665}00665\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00666}00666\ \textcolor{comment}{//\ \ \ \ \ //\ 스크립트를\ 통해\ 바로\ 시작을\ 하고\ 싶으면}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00667}00667\ \textcolor{comment}{//\ \ \ \ \ auto\_daemon\_mode();}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00668}00668\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00669}00669\ \textcolor{comment}{//\ \ \ \ \ //\ server코드를\ 통해\ 직접\ 관리하고\ 싶으면}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00670}00670\ \textcolor{comment}{//\ \ \ \ \ /*}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00671}00671\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ //\ 로고\ 출력}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00672}00672\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ logo();}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00673}00673\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printf("{}이\ 프로그램을\ 자동으로\ 데몬\ 화\ 하고\ 싶으시다면\ 스크립트를\ 참조하세요.\(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00674}00674\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00675}00675\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ //\ 사용자가\ 동작\ 방식을\ 선택할\ 수\ 있게\ 함}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00676}00676\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printf("{}서버\ 동작\ 방식을\ 선택하세요:\ \(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00677}00677\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printf("{}1.\ 자동\ 데몬화\(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00678}00678\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printf("{}2.\ 수동\ 서버\ 관리\(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00679}00679\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printf("{}선택:\ "{});}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00680}00680\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00681}00681\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ yn\ =\ getchar();}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00682}00682\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ while\ (getchar()\ !=\ '\(\backslash\)n');\ \ //\ 남은\ 입력\ 버퍼\ 비우기}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00683}00683\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00684}00684\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (yn\ ==\ '1')\ \{}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00685}00685\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ auto\_daemon\_mode();\ \ //\ 자동\ 데몬화\ 모드\ 실행}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00686}00686\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \}\ else\ if\ (yn\ ==\ '2')\ \{}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00687}00687\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ manual\_server\_mode();\ \ //\ 수동\ 서버\ 관리\ 모드\ 실행}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00688}00688\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \}\ else\ \{}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00689}00689\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ printf("{}잘못된\ 선택입니다.\ 프로그램을\ 종료합니다.\(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00690}00690\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ return\ -\/1;}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00691}00691\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00692}00692\ \textcolor{comment}{//\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00693}00693\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00694}00694\ \textcolor{comment}{//\ \ \ \ \ return\ 0;}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00695}00695\ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00696}00696\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00697}00697\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00698}00698\ \textcolor{preprocessor}{\#define\ MAX\_CLIENTS\ 10}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00699}00699\ \textcolor{preprocessor}{\#define\ BUFFER\_SIZE\ 1024}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00700}00700\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00707}\mbox{\hyperlink{kernel__chat_8c_accc3bca97be7297ed8e780179d4bd0e0}{00707}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{kernel__chat_8c_accc3bca97be7297ed8e780179d4bd0e0}{kernel\_chat}}(\textcolor{keywordtype}{int}\ num\_args,\ ...)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00708}00708\ \ \ \ \ \textcolor{keywordtype}{int}\ network\_fd;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00709}00709\ \ \ \ \ \textcolor{keyword}{struct\ }sockaddr\_in\ server\_addr;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00710}00710\ \ \ \ \ va\_list\ args;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00711}00711\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00712}00712\ \ \ \ \ \textcolor{comment}{//\ 가변\ 인자\ 리스트\ 초기화}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00713}00713\ \ \ \ \ va\_start(args,\ num\_args);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00714}00714\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00715}00715\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *server\_ip\ =\ va\_arg(args,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *);\ \textcolor{comment}{//\ 첫\ 번째\ 인자는\ 서버\ IP}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00716}00716\ \ \ \ \ \textcolor{keywordtype}{int}\ port\ =\ va\_arg(args,\ \textcolor{keywordtype}{int});\ \textcolor{comment}{//\ 두\ 번째\ 인자는\ 포트}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00717}00717\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00718}00718\ \ \ \ \ va\_end(args);\ \ \textcolor{comment}{//\ 가변\ 인자\ 리스트\ 종료}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00719}00719\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00720}00720\ \ \ \ \ \textcolor{comment}{//\ 네트워크\ 설정}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00721}00721\ \ \ \ \ network\_fd\ =\ socket(AF\_INET,\ SOCK\_STREAM,\ 0);\ \ \textcolor{comment}{//\ 소켓\ 생성}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00722}00722\ \ \ \ \ \textcolor{keywordflow}{if}\ (network\_fd\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00723}00723\ \ \ \ \ \ \ \ \ perror(\textcolor{stringliteral}{"{}socket()\ 생성\ 실패"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00724}00724\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memo_8c_a96ea01c2f2df57143885cf02de009298}{kernel\_printf}}(\textcolor{stringliteral}{"{}socket()\ 생성\ 실패\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00725}00725\ \ \ \ \ \ \ \ \ exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00726}00726\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00727}00727\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memo_8c_a96ea01c2f2df57143885cf02de009298}{kernel\_printf}}(\textcolor{stringliteral}{"{}socket()\ 생성\ 성공\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00728}00728\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00729}00729\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00730}00730\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00731}00731\ \ \ \ \ memset(\&server\_addr,\ 0,\ \textcolor{keyword}{sizeof}(server\_addr));}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00732}00732\ \ \ \ \ server\_addr.sin\_family\ =\ AF\_INET;}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00733}00733\ \ \ \ \ server\_addr.sin\_addr.s\_addr\ =\ inet\_addr(server\_ip);\ \ \textcolor{comment}{//\ 가변\ 인자로\ 받은\ 서버\ IP}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00734}00734\ \ \ \ \ server\_addr.sin\_port\ =\ htons(port);\ \ \textcolor{comment}{//\ 가변\ 인자로\ 받은\ 포트}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00735}00735\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00736}00736\ \ \ \ \ \textcolor{comment}{//\ 소켓\ 바인딩}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00737}00737\ \ \ \ \ \textcolor{keywordflow}{if}\ (bind(network\_fd,\ (\textcolor{keyword}{struct}\ sockaddr\ *)\&server\_addr,\ \textcolor{keyword}{sizeof}(server\_addr))\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00738}00738\ \ \ \ \ \ \ \ \ perror(\textcolor{stringliteral}{"{}bind()\ 실패"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00739}00739\ \ \ \ \ \ \ \ \ close(network\_fd);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00740}00740\ \ \ \ \ \ \ \ \ exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00741}00741\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00742}00742\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00743}00743\ \ \ \ \ \textcolor{comment}{//\ 소켓\ 리스닝}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00744}00744\ \ \ \ \ \textcolor{keywordflow}{if}\ (listen(network\_fd,\ \mbox{\hyperlink{kernel__chat_8c_a0a8f91f93d75a07f0ae45077db45b3eb}{MAX\_CLIENTS}})\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00745}00745\ \ \ \ \ \ \ \ \ perror(\textcolor{stringliteral}{"{}listen()\ 실패"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00746}00746\ \ \ \ \ \ \ \ \ close(network\_fd);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00747}00747\ \ \ \ \ \ \ \ \ exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00748}00748\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00749}00749\ \ \ \ \ \mbox{\hyperlink{memo_8c_a96ea01c2f2df57143885cf02de009298}{kernel\_printf}}(\textcolor{stringliteral}{"{}서버가\ 포트\ \%d에서\ 대기\ 중입니다...\(\backslash\)n"{}},\ port);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00750}00750\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00751}00751\ \ \ \ \ \textcolor{comment}{//\ 소켓\ 포트\ 정보\ 조회}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00752}00752\ \ \ \ \ \mbox{\hyperlink{memo_8c_a96ea01c2f2df57143885cf02de009298}{kernel\_printf}}(\textcolor{stringliteral}{"{}현재\ 포트\ \%d\ 상태를\ 확인합니다.\(\backslash\)n"{}},\ port);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00753}00753\ \ \ \ \ \mbox{\hyperlink{memo_8c_a96ea01c2f2df57143885cf02de009298}{kernel\_printf}}(\textcolor{stringliteral}{"{}**************************************************\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00754}00754\ \ \ \ \ \textcolor{keywordflow}{if}\ (system(\textcolor{stringliteral}{"{}lsof\ -\/i\ :5100"{}})\ !=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00755}00755\ \ \ \ \ \ \ \ \ perror(\textcolor{stringliteral}{"{}lsof\ 명령\ 실행\ 실패"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00756}00756\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memo_8c_a96ea01c2f2df57143885cf02de009298}{kernel\_printf}}(\textcolor{stringliteral}{"{}lsof\ 명령\ 실행\ 실패\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00757}00757\ \ \ \ \ \ \ \ \ close(network\_fd);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00758}00758\ \ \ \ \ \ \ \ \ exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00759}00759\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00760}00760\ \ \ \ \ \mbox{\hyperlink{memo_8c_a96ea01c2f2df57143885cf02de009298}{kernel\_printf}}(\textcolor{stringliteral}{"{}**************************************************\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00761}00761\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00762}00762\ \ \ \ \ \textcolor{comment}{//\ 불필요한\ 변수들을\ 주석\ 처리하거나\ 삭제}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00763}00763\ \ \ \ \ \textcolor{comment}{//\ while\ (1)\ \{}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00764}00764\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ socklen\_t\ client\_len\ =\ sizeof(client\_addr);}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00765}00765\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ client\_fd\ =\ accept(network\_fd,\ (struct\ sockaddr\ *)\&client\_addr,\ \&client\_len);}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00766}00766\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ if\ (client\_fd\ <\ 0)\ \{}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00767}00767\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ perror("{}accept()\ 실패"{});}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00768}00768\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ continue;}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00769}00769\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \}}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00770}00770\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ printf("{}클라이언트가\ 연결되었습니다.\(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00771}00771\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ ssize\_t\ nbytes;}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00772}00772\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ while\ ((nbytes\ =\ read(client\_fd,\ buffer,\ sizeof(buffer)))\ >\ 0)\ \{}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00773}00773\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ buffer[nbytes]\ =\ '\(\backslash\)0';}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00774}00774\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ printf("{}클라이언트\ 메시지:\ \%s\(\backslash\)n"{},\ buffer);}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00775}00775\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ const\ char\ *response\ =\ "{}서버에서\ 수신했습니다.\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00776}00776\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ write(client\_fd,\ response,\ strlen(response));}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00777}00777\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \}}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00778}00778\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ printf("{}클라이언트\ 연결\ 종료\(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00779}00779\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ close(client\_fd);}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00780}00780\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00781}00781\ }
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00782}00782\ \ \ \ \ \textcolor{comment}{//\ close(network\_fd);\ \ //\ 네트워크\ 소켓\ 닫기}}
\DoxyCodeLine{\Hypertarget{kernel__chat_8c_source_l00783}00783\ \}}

\end{DoxyCode}
